{% extends 'SIL/base.html' %}

{% load static%}
{%block head_block%}

<!-- DataTables CSS -->
<link rel="stylesheet" type="text/css" href="{% static '/static/DataTables-1.10.5/media/css/jquery.dataTables.css' %}">
<!-- DataTables -->
<script type="text/javascript" charset="utf8" src="{% static '/static/DataTables-1.10.5/media/js/jquery.dataTables.js' %}"></script>


<script type="text/javascript">

    $(document).ready(function () {
        $('table').dataTable({
         "scrollX": true,
          "scrollY": '500px'
         });
         $('.metrics > a').on('click', showData);
    });

    function showData(event){
        $el=$(event.delegateTarget);
        id=$el.data('table-id');

        $('div#' + id).removeClass('hide');
        $("div.table:not('#" + id +"')").addClass('hide');
    }

</script>

<style>
    .boxed {
        border: 1.5px solid #22BA48;
        border-radius: 10px;
        margin: 10%;
        padding:  10px;
    }
    .metrics{
        margin-left: 7%;
    }
</style>
{% endblock %}

{% block title %}{{ action }}{% endblock %}

{% block body_block %}
    <div class="hero-unit">
        {% if action %}
        <h2>{{ action}}</h2>
            {% if action_name == 'get_all_cards' %}
                <div class="row metrics">
                   <a href="#" id="assigned" data-table-id="mycards">
                        <div class="span2 boxed">
                                <h5 align="center">Cards Assigned To Me</h5>
                                <h3 align="center">{{ assigned_count }}</h3>
                        </div>
                   </a>

                   <a href="#" id="due" data-table-id="due_cards">
                        <div class="span2 boxed">
                            <h5 align="center">Cards Due Date In 7 Days</h5>
                            <h3 align="center">{{ due_in_seven_count }}</h3>
                        </div>
                   </a>

                   <a href="#" id="pastdue" data-table-id="past_due_cards">
                        <div class="span2 boxed">
                            <h5 align="center">Cards Past Due</h5>
                            <h3 align="center">{{ past_due_count }}</h3>
                        </div>
                   </a>

                    <a href="#" id="total_cards" data-table-id="total">
                        <div class="span2 boxed">
                            <h5 align="center">Total Cards</h5>
                            <h3 align="center">{{ total_cards}}</h3>
                        </div>
                    </a>
                </div> <!--/row-->
            {% endif %}
        {% else %}
            <h2>Oops... Call Error</h2>
        {% endif %}
        <br>
        {% if call %}
            <!--{{ response }}-->
        <br>
            <!--{{ labels }}-->
        {%  for key,items in card_lists.items %}
        <div class="table{% if key != 'total' %} hide {% endif %}" id="{{key}}">
            <table class="table table-striped dataTable display">
                <thead>
                    <tr>
                        {% for label in labels %}
                        <th> {{label}} </th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for item in items %}
                    <tr>
                        {% for col,data in item.items %}
                        <td>
                                {% if 'url' in col or 'Url' in col%}
                                    <a target='_blank' href="{{data}}">{{data}}</a>
                                {% else %}
                                    {{ data }}
                                {% endif %}
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endfor %}
        {% else %}
            The specified call {{ action }} did not return anything!
            <br>
            <h4>Possible Reasons:</h4>
            <ul>
                <li>The Api is misspelled or not created yet </li>
                <li>The Call returned an error or is not yet set up</li>
                <li>Something somewhere is down</li>
            </ul>
        {% endif %}
    </div>
{% endblock %}